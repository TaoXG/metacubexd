import{v as B,R as F,T as z,C as A,i as d,c as h,a3 as P,F as T,b as E,h as U,p as q,o as H}from"./vendor-5de92a4b.js";import{c as M,v as N,z as f}from"./index-1720af8e.js";import{e as m,B as _,s as v,a as X,b as S}from"./index-ae299b11.js";import{t as G}from"./global-bd28eeed.js";let x;const J=new Uint8Array(16);function K(){if(!x&&(x=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!x))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return x(J)}const l=[];for(let t=0;t<256;++t)l.push((t+256).toString(16).slice(1));function O(t,e=0){return(l[t[e+0]]+l[t[e+1]]+l[t[e+2]]+l[t[e+3]]+"-"+l[t[e+4]]+l[t[e+5]]+"-"+l[t[e+6]]+l[t[e+7]]+"-"+l[t[e+8]]+l[t[e+9]]+"-"+l[t[e+10]]+l[t[e+11]]+l[t[e+12]]+l[t[e+13]]+l[t[e+14]]+l[t[e+15]]).toLowerCase()}const Q=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),C={randomUUID:Q};function W(t,e,a){if(C.randomUUID&&!e&&!t)return C.randomUUID();t=t||{};const i=t.random||(t.rng||K)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,e){a=a||0;for(let c=0;c<16;++c)e[a+c]=i[c];return e}return O(i)}const Y=E('<div class="mx-auto flex max-w-screen-md flex-col items-center gap-4 py-10"><form class="contents"><div class="flex w-full flex-col gap-4"><div class="flex-1"><label class="label"><span class="label-text"></span></label><input name="url" type="url" class="input input-bordered w-full" placeholder="http://127.0.0.1:9090" list="defaultEndpoints"><datalist id="defaultEndpoints"><option value="http://127.0.0.1:9090"></option></datalist></div><div class="flex-1"><label class="label"><span class="label-text"></span></label><input name="secret" type="password" class="input input-bordered w-full" placeholder="secret"></div></div></form><div class="flex w-full flex-col gap-4">'),Z=E('<div class="badge badge-info flex w-full cursor-pointer items-center gap-4 py-4">'),tt=f.object({url:f.string().nonempty(),secret:f.string()}),ot=()=>{const[t]=B(),e=F(),a=n=>{S(n),e("/overview")},i=(n,s)=>H.get(n,{headers:s?{Authorization:`Bearer ${s}`}:{}}).then(({ok:o})=>o).catch(o=>{const{message:r}=o;U.error(r)}),c=async n=>{const s=m().find(o=>o.id===n);s&&await i(s.url,s.secret)&&a(n)},y=async({url:n,secret:s})=>{const o=G(n);if(!await i(o,s))return;const r=W(),p=m().slice(),u=p.find(b=>b.url===o);if(!u){v([{id:r,url:o,secret:s},...p]),a(r);return}u.secret=s,u.id=r,v(p),a(r)},R=n=>{const{message:s}=n;U.error(s)},{form:w}=M({extend:N({schema:tt}),onSubmit:y,onError:R}),I=n=>{X()===n&&S(""),v(m().filter(s=>s.id!==n))};return z(()=>{const n=new URLSearchParams(window.location.search);n.has("hostname")?y({url:`${window.location.protocol}//${n.get("hostname")}${n.get("port")?`:${n.get("port")}`:""}`,secret:n.get("secret")??""}):m().length===0&&y({url:"http://127.0.0.1:9090",secret:""})}),(()=>{const n=Y(),s=n.firstChild,o=s.firstChild,r=o.firstChild,p=r.firstChild,u=p.firstChild,b=r.nextSibling,L=b.firstChild,k=L.firstChild,D=s.nextSibling;return A(w,s,()=>w),d(u,()=>t("endpointURL")),d(k,()=>t("secret")),d(o,h(_,{type:"submit",class:"btn-primary join-item uppercase",get children(){return t("add")}}),null),d(D,h(T,{get each(){return m()},children:({id:$,url:V})=>(()=>{const g=Z();return g.$$click=()=>c($),d(g,V,null),d(g,h(_,{class:"btn-circle btn-ghost btn-xs text-white",onClick:j=>{j.stopPropagation(),I($)},get children(){return h(P,{})}}),null),g})()})),n})()};q(["click"]);export{ot as default};
